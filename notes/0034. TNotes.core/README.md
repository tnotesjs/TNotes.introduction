# [0034. TNotes.core](https://github.com/tnotesjs/TNotes.introduction/tree/main/notes/0034.%20TNotes.core)

<!-- region:toc -->

- [1. ğŸ¯ æœ¬èŠ‚å†…å®¹](#1--æœ¬èŠ‚å†…å®¹)
- [2. ğŸ«§ è¯„ä»·](#2--è¯„ä»·)
- [3. æ–¹æ¡ˆæ¦‚è¿°](#3-æ–¹æ¡ˆæ¦‚è¿°)
  - [3.1. é‡‡ç”¨ Git Submodule](#31-é‡‡ç”¨-git-submodule)
  - [3.2. å†³ç­–è®°å½•](#32-å†³ç­–è®°å½•)
- [4. ä»“åº“ç»“æ„](#4-ä»“åº“ç»“æ„)
  - [4.1. TNotes.core ä»“åº“](#41-tnotescore-ä»“åº“)
  - [4.2. TNotes.xxx ä»“åº“ï¼ˆä»¥ TNotes.introduction ä¸ºä¾‹ï¼‰](#42-tnotesxxx-ä»“åº“ä»¥-tnotesintroduction-ä¸ºä¾‹)
  - [4.3. æ–‡ä»¶å½’å±åˆ’åˆ†](#43-æ–‡ä»¶å½’å±åˆ’åˆ†)
- [5. æ—¥å¸¸å·¥ä½œæµ](#5-æ—¥å¸¸å·¥ä½œæµ)
  - [5.1. ç¼–è¾‘è„šæœ¬](#51-ç¼–è¾‘è„šæœ¬)
  - [5.2. æäº¤è„šæœ¬å˜æ›´](#52-æäº¤è„šæœ¬å˜æ›´)
  - [5.3. å…¶ä»–ä»“åº“æ‹‰å–æœ€æ–°è„šæœ¬](#53-å…¶ä»–ä»“åº“æ‹‰å–æœ€æ–°è„šæœ¬)
  - [5.4. å›æ»šåˆ°æ—§ç‰ˆæœ¬](#54-å›æ»šåˆ°æ—§ç‰ˆæœ¬)
  - [5.5. æ–°ä»“åº“ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬](#55-æ–°ä»“åº“ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬)
- [6. ç‰ˆæœ¬ç®¡ç†](#6-ç‰ˆæœ¬ç®¡ç†)
- [7. CI/CD è°ƒæ•´](#7-cicd-è°ƒæ•´)
- [8. æ³¨æ„äº‹é¡¹](#8-æ³¨æ„äº‹é¡¹)
  - [8.1. è·¯å¾„å¼•ç”¨](#81-è·¯å¾„å¼•ç”¨)
  - [8.2. Git çŠ¶æ€ç®¡ç†](#82-git-çŠ¶æ€ç®¡ç†)
  - [8.3. æ–‡ä»¶ç›‘å¬æœåŠ¡](#83-æ–‡ä»¶ç›‘å¬æœåŠ¡)
  - [8.4. å¤–å›´æ–‡ä»¶ç»´æŠ¤](#84-å¤–å›´æ–‡ä»¶ç»´æŠ¤)
- [9. è¿ç§»è®¡åˆ’](#9-è¿ç§»è®¡åˆ’)
  - [9.1. ç¬¬ä¸€é˜¶æ®µï¼šåˆ›å»º TNotes.core](#91-ç¬¬ä¸€é˜¶æ®µåˆ›å»º-tnotescore)
  - [9.2. ç¬¬äºŒé˜¶æ®µï¼šè¯•ç‚¹ TNotes.introduction](#92-ç¬¬äºŒé˜¶æ®µè¯•ç‚¹-tnotesintroduction)
  - [9.3. ç¬¬ä¸‰é˜¶æ®µï¼šé€æ­¥æ¨å¹¿](#93-ç¬¬ä¸‰é˜¶æ®µé€æ­¥æ¨å¹¿)
  - [9.4. ç¬¬å››é˜¶æ®µï¼šæ¸…ç†](#94-ç¬¬å››é˜¶æ®µæ¸…ç†)

<!-- endregion:toc -->

## 1. ğŸ¯ æœ¬èŠ‚å†…å®¹

- TNotes.core æ–¹æ¡ˆè®¾è®¡æ–‡æ¡£

## 2. ğŸ«§ è¯„ä»·

å°†æ ¸å¿ƒè„šæœ¬æŠ½ç¦»ä¸ºç‹¬ç«‹çš„ GitHub ä»“åº“ `TNotes.core`ï¼Œæ‰€æœ‰ TNotes.xxx çŸ¥è¯†åº“é€šè¿‡ Git Submodule å¼•ç”¨åŒä¸€ä»½è„šæœ¬

## 3. æ–¹æ¡ˆæ¦‚è¿°

### 3.1. é‡‡ç”¨ Git Submodule

- **TNotes.core**ï¼šç‹¬ç«‹ GitHub ä»“åº“ï¼Œå­˜æ”¾æ ¸å¿ƒè„šæœ¬
- **å„ TNotes.xxx**ï¼šé€šè¿‡ submodule å¼•ç”¨ TNotes.coreï¼ŒæŒ‚è½½åˆ° `.vitepress/tnotes/`
- æ¯ä¸ªä»“åº“æœ¬åœ°æœ‰å®Œæ•´çš„ tnotes-core ä»£ç ï¼Œå¯åœ¨ä»»æ„çŸ¥è¯†åº“ä¸­ç›´æ¥ç¼–è¾‘å¹¶æ¨é€
- å…¶ä»–ä»“åº“éœ€æ‰‹åŠ¨æ‰§è¡Œ `git submodule update --remote` æ¥æ‹‰å–æœ€æ–°ç‰ˆæœ¬

### 3.2. å†³ç­–è®°å½•

| å†³ç­–ç‚¹ | é€‰æ‹© | ç†ç”± |
| --- | --- | --- |
| Submodule æŒ‚è½½ç‚¹ | `.vitepress/tnotes/` | ä¸å½“å‰è·¯å¾„ä¸€è‡´ï¼Œé›¶è·¯å¾„æ”¹åŠ¨ |
| å¤–å›´æ–‡ä»¶å¤„ç† | ç•™åœ¨å„ä»“åº“ï¼Œæå°‘å˜åŠ¨æ—¶æ‰‹åŠ¨æ›´æ–° | å¤§éƒ¨åˆ†å¤–å›´æ–‡ä»¶å‡ ä¹ä¸å˜ï¼Œä¸å€¼å¾—ä¸ºæ­¤å¢åŠ å¤æ‚åº¦ |
| æ‰¹é‡åŒæ­¥æ–¹å¼ | æš‚ä¸å¤„ç†ï¼Œå…ˆç¡®ä¿è¯•ç‚¹æˆåŠŸ | åç»­å†è€ƒè™‘ä¸€é”®åŒæ­¥è„šæœ¬ |
| æ–°ä»“åº“åˆå§‹åŒ– | ç¼–å†™åˆå§‹åŒ–è„šæœ¬ | è‡ªåŠ¨åŒ– submodule æ·»åŠ å’Œæ¨¡æ¿æ–‡ä»¶å¤åˆ¶ |
| è¿ç§»ç­–ç•¥ | å…ˆè¯•ç‚¹ TNotes.introductionï¼Œå†é€æ­¥æ¨å¹¿ | é™ä½é£é™©ï¼ŒéªŒè¯é€šè¿‡åå†æ‰¹é‡è¿ç§» |

## 4. ä»“åº“ç»“æ„

### 4.1. TNotes.core ä»“åº“

```text
TNotes.core/
â”œâ”€â”€ commands/                     # å‘½ä»¤å±‚
â”œâ”€â”€ config/                       # é…ç½®å±‚
â”œâ”€â”€ core/                         # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ services/                     # æœåŠ¡å±‚ï¼ˆæ–‡ä»¶ç›‘å¬ã€Gitã€ç¬”è®°ç­‰ï¼‰
â”œâ”€â”€ types/                        # ç±»å‹å®šä¹‰
â”œâ”€â”€ utils/                        # å·¥å…·å‡½æ•°
â”œâ”€â”€ vitepress/                    # VitePress å‰ç«¯å±‚ï¼ˆç»„ä»¶ã€é…ç½®ã€æ’ä»¶ã€ä¸»é¢˜ï¼‰
â”œâ”€â”€ index.ts                      # å…¥å£
â””â”€â”€ README.md
```

å³å½“å‰ `.vitepress/tnotes/` ç›®å½•çš„å…¨éƒ¨å†…å®¹ï¼Œä¹Ÿæ˜¯ TNotes.core ä»“åº“çš„æ ¹ç›®å½•ã€‚

### 4.2. TNotes.xxx ä»“åº“ï¼ˆä»¥ TNotes.introduction ä¸ºä¾‹ï¼‰

```text
TNotes.introduction/
â”œâ”€â”€ .gitmodules                   # æ–°å¢ï¼šsubmodule å£°æ˜
â”œâ”€â”€ .vitepress/
â”‚   â”œâ”€â”€ tnotes/                   # submodule â†’ TNotes.core
â”‚   â”œâ”€â”€ theme/index.ts            # ç•™åœ¨æœ¬ä»“åº“ï¼ˆä¸€è¡Œé‡å¯¼å‡ºï¼Œå‡ ä¹ä¸å˜ï¼‰
â”‚   â”œâ”€â”€ config.mts                # ç•™åœ¨æœ¬ä»“åº“ï¼ˆå¼•ç”¨ tnotes/ å†…æ¨¡å—ï¼‰
â”‚   â”œâ”€â”€ env.d.ts                  # ç•™åœ¨æœ¬ä»“åº“
â”‚   â””â”€â”€ cache/                    # ä»“åº“ç‹¬æœ‰
â”œâ”€â”€ .tnotes.json                  # ä»“åº“ç‹¬æœ‰é…ç½®
â”œâ”€â”€ notes/                        # ä»“åº“ç‹¬æœ‰ç¬”è®°å†…å®¹
â”œâ”€â”€ README.md                     # ä»“åº“ç‹¬æœ‰
â”œâ”€â”€ sidebar.json                  # ä»“åº“ç‹¬æœ‰
â”œâ”€â”€ package.json                  # ç•™åœ¨æœ¬ä»“åº“ï¼ˆæå°‘å˜åŠ¨æ—¶æ‰‹åŠ¨æ›´æ–°ï¼‰
â”œâ”€â”€ tsconfig.json                 # ç•™åœ¨æœ¬ä»“åº“
â”œâ”€â”€ .github/workflows/deploy.yml  # ç•™åœ¨æœ¬ä»“åº“
â”œâ”€â”€ .vscode/                      # ç•™åœ¨æœ¬ä»“åº“
â”œâ”€â”€ public/                       # ç•™åœ¨æœ¬ä»“åº“
â”œâ”€â”€ Settings.md                   # ç•™åœ¨æœ¬ä»“åº“
â””â”€â”€ Loading.md                    # ç•™åœ¨æœ¬ä»“åº“
```

### 4.3. æ–‡ä»¶å½’å±åˆ’åˆ†

**TNotes.core ç®¡ç†ï¼ˆsubmodule å†…ï¼‰ï¼š**

- æ ¸å¿ƒè„šæœ¬å…¨éƒ¨ 161 ä¸ªæ–‡ä»¶ï¼ˆcommandsã€configã€coreã€servicesã€typesã€utilsã€vitepressï¼‰

**å„ä»“åº“è‡ªè¡Œç®¡ç†ï¼ˆsubmodule å¤–ï¼‰ï¼š**

- `.tnotes.json` â€” ä»“åº“ç‹¬æœ‰é…ç½®ï¼ˆrepoNameã€portã€socialLinks ç­‰ï¼‰
- `notes/` â€” ç¬”è®°å†…å®¹
- `README.md`ã€`sidebar.json`ã€`index.md` â€” ç¬”è®°ç›®å½•
- `.vitepress/config.mts` â€” VitePress ç«™ç‚¹é…ç½®
- `.vitepress/theme/index.ts` â€” ä¸»é¢˜å…¥å£ï¼ˆä¸€è¡Œé‡å¯¼å‡ºï¼‰
- `.vitepress/env.d.ts` â€” ç±»å‹å£°æ˜
- `package.json`ã€`tsconfig.json` â€” é¡¹ç›®é…ç½®
- `.github/workflows/deploy.yml` â€” CI/CD
- `.vscode/settings.json`ã€`.vscode/tasks.json` â€” ç¼–è¾‘å™¨é…ç½®
- `public/`ã€`Settings.md`ã€`Loading.md` â€” é™æ€èµ„æºå’Œå…±ç”¨é¡µé¢

## 5. æ—¥å¸¸å·¥ä½œæµ

### 5.1. ç¼–è¾‘è„šæœ¬

åœ¨ä»»æ„ TNotes.xxx ä¸­ç›´æ¥ç¼–è¾‘ `.vitepress/tnotes/` å†…çš„æ–‡ä»¶ï¼ŒVitePress HMR å³æ—¶ç”Ÿæ•ˆã€‚

### 5.2. æäº¤è„šæœ¬å˜æ›´

```bash
# 1. è¿›å…¥ submodule ç›®å½•ï¼Œæäº¤å¹¶æ¨é€åˆ° TNotes.core
cd .vitepress/tnotes
git add -A
git commit -m "fix: ä¿®å¤æ–‡ä»¶ç›‘å¬äº‹ä»¶é‡å¤è§¦å‘"
git push

# 2. å›åˆ°çˆ¶ä»“åº“ï¼Œæ›´æ–° submodule æŒ‡é’ˆå¹¶æäº¤
cd ../..
git add .vitepress/tnotes
git commit -m "update TNotes.core"
git push
```

### 5.3. å…¶ä»–ä»“åº“æ‹‰å–æœ€æ–°è„šæœ¬

```bash
cd ~/tnotesjs/TNotes.javascript
git submodule update --remote
git add .vitepress/tnotes
git commit -m "update TNotes.core"
git push
```

### 5.4. å›æ»šåˆ°æ—§ç‰ˆæœ¬

```bash
cd .vitepress/tnotes
git checkout <commit-hash-or-tag>
cd ../..
git add .vitepress/tnotes
git commit -m "rollback TNotes.core to <version>"
```

### 5.5. æ–°ä»“åº“ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬

```bash
git submodule add https://github.com/tnotesjs/TNotes.core.git .vitepress/tnotes
cd .vitepress/tnotes
git checkout v1.2.0
cd ../..
git add .vitepress/tnotes .gitmodules
git commit -m "init TNotes.core at v1.2.0"
```

## 6. ç‰ˆæœ¬ç®¡ç†

ç”± Git Submodule æœºåˆ¶å¤©ç„¶å®Œæˆï¼š

- æ¯ä¸ª TNotes.xxx åœ¨ Git ä¸­è®°å½•å¼•ç”¨çš„ TNotes.core **ç²¾ç¡® commit hash**
- å„ä»“åº“ç‹¬ç«‹é”å®šç‰ˆæœ¬ï¼Œäº’ä¸å½±å“
- æ›´æ–°ã€å›æ»šéƒ½é€šè¿‡ Git å‘½ä»¤å®Œæˆï¼Œæ— éœ€é¢å¤–å·¥å…·
- å¯é€‰åœ¨ TNotes.core ä¸Šæ‰“ tag æ ‡è®°é‡Œç¨‹ç¢‘ç‰ˆæœ¬ï¼ˆå¦‚å®Œæˆä¸€è½®å¤§é‡æ„åï¼‰

## 7. CI/CD è°ƒæ•´

å„ä»“åº“çš„ `.github/workflows/deploy.yml` éœ€è¦ä¿®æ”¹ checkout æ­¥éª¤ï¼š

```yaml
- uses: actions/checkout@v4
  with:
    fetch-depth: 0
    submodules: true
```

## 8. æ³¨æ„äº‹é¡¹

### 8.1. è·¯å¾„å¼•ç”¨

æŒ‚è½½ç‚¹é€‰æ‹© `.vitepress/tnotes/`ï¼Œä¸å½“å‰è·¯å¾„å®Œå…¨ä¸€è‡´ï¼Œè„šæœ¬ä¸­æ‰€æœ‰åŸºäº `import.meta.url` å’Œç›¸å¯¹è·¯å¾„çš„å¼•ç”¨æ— éœ€ä¿®æ”¹ã€‚

### 8.2. Git çŠ¶æ€ç®¡ç†

åœ¨çŸ¥è¯†åº“ä¸­ç¼–è¾‘äº† submodule å†…çš„è„šæœ¬ä½†å°šæœªæäº¤æ—¶ï¼Œçˆ¶ä»“åº“çš„ `git status` ä¼šæ˜¾ç¤º `.vitepress/tnotes (modified content)`ã€‚å»ºè®®å…»æˆä¹ æƒ¯ï¼šå…ˆå¤„ç† submodule å†…çš„æäº¤ï¼Œå†å¤„ç†çˆ¶ä»“åº“çš„æäº¤ã€‚

### 8.3. æ–‡ä»¶ç›‘å¬æœåŠ¡

`fsWatcherAdapter` ç›‘å¬çš„æ˜¯ `notes/` ç›®å½•ï¼Œä¸ `.vitepress/tnotes/` æ— å…³ï¼Œä¸å— submodule å½±å“ã€‚

### 8.4. å¤–å›´æ–‡ä»¶ç»´æŠ¤

`config.mts`ã€`package.json` ç­‰ç•™åœ¨å„ä»“åº“çš„æ–‡ä»¶ï¼Œåœ¨æå°‘éœ€è¦å˜æ›´æ—¶ï¼ˆå¦‚æ–°å¢ä¾èµ–ã€è°ƒæ•´ VitePress é…ç½®ï¼‰ï¼Œéœ€æ‰‹åŠ¨åŒæ­¥åˆ°å…¶ä»–ä»“åº“ã€‚å¯ä»¥ä¿ç•™ä¸€ä¸ªç²¾ç®€ç‰ˆ sync è„šæœ¬ä¸“é—¨å¤„ç†è¿™äº›æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æ“ä½œã€‚

## 9. è¿ç§»è®¡åˆ’

### 9.1. ç¬¬ä¸€é˜¶æ®µï¼šåˆ›å»º TNotes.core

1. åœ¨ GitHub ä¸Šåˆ›å»º `tnotesjs/TNotes.core` ä»“åº“
2. å°† TNotes.introduction çš„ `.vitepress/tnotes/` å†…å®¹å¤åˆ¶åˆ° TNotes.core
3. é¦–æ¬¡ commitï¼Œæ‰“ tag `v1.0.0`

### 9.2. ç¬¬äºŒé˜¶æ®µï¼šè¯•ç‚¹ TNotes.introduction

1. ç»™ TNotes.introduction æ‰“ tag æˆ–å¼€åˆ†æ”¯ï¼Œä¾¿äºå›æ»š
2. åˆ é™¤ `.vitepress/tnotes/` ç›®å½•
3. æ‰§è¡Œ `git submodule add` æ·»åŠ  TNotes.core
4. ä¿®æ”¹ `.github/workflows/deploy.yml`ï¼Œæ·»åŠ  `submodules: true`
5. éªŒè¯ `tn:dev` å¯åŠ¨æ­£å¸¸
6. éªŒè¯æ–‡ä»¶ç›‘å¬ã€AboutPannel æ›´æ–°ã€é‡å‘½åæ£€æµ‹ç­‰åŠŸèƒ½æ­£å¸¸
7. éªŒè¯ `tn:build` æ„å»ºæ­£å¸¸
8. éªŒè¯ GitHub Actions éƒ¨ç½²æ­£å¸¸

### 9.3. ç¬¬ä¸‰é˜¶æ®µï¼šé€æ­¥æ¨å¹¿

1. é€‰æ‹© 2-3 ä¸ªæ´»è·ƒä»“åº“è¿ç§»å¹¶éªŒè¯
2. æ‰¹é‡è¿ç§»å‰©ä½™ä»“åº“
3. ç¼–å†™æ–°ä»“åº“åˆå§‹åŒ–è„šæœ¬

### 9.4. ç¬¬å››é˜¶æ®µï¼šæ¸…ç†

1. ç§»é™¤æ—§çš„ `tn:sync-scripts` è„šæœ¬é€»è¾‘ï¼ˆæˆ–æ”¹ä¸ºä»…å¤„ç†å¤–å›´æ–‡ä»¶ï¼‰
2. æ›´æ–°ç›¸å…³æ–‡æ¡£
