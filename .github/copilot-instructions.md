# copilot instructions

## 更新逻辑

- [x] 在 `AboutPannel.vue` 中，笔记标题、笔记简介、完成状态、评论状态、弃用状态，只要这些发生变化，需要同步更新到笔记的配置文件中。这一点目前已经完成了。
- [x] 在 `AboutPannel.vue` 中，笔记标题、笔记简介、完成状态、弃用状态，这些是跟根目录下的 README.md 以及 sidebar.json 文件相关的，因为全局文件中存储的是目录相关的信息，这些内容的变化会影响到目录结构的呈现。在更新根目录下的 README.md 的时候，需要根据笔记 ID 来查找对应的记录，以此来完成更新，不要扫描整个 notes 目录，然后 sidebar.json 再根据修改后的 README.md 来自动生成。
- [x] 笔记简介、完成状态、评论状态、弃用状态，这些状态的变更也可能来自于用户直接修改笔记配置文件 `tnotes.json`，这需要在文件变更监听服务中加上处理逻辑，当监听到变化之后，处理逻辑跟用户通过 UI 界面来修改配置并保存的逻辑是一致的。
- [x] 笔记标题的变化需要分情况：
  - [x] 笔记目录直接被删除了，这时候需要在 home readme.md 和 sidebar.json 中，根据笔记的原 ID 去查找对应的记录，并将记录给删除掉；
  - [x] 笔记文件夹还在，这时候需要先检查 ID，如果 ID 非法（ID 不是 4 个数字打头或者 ID 重复）那么重命名操作无效，自动回退到原始名称。如果 ID 合法，则判断 ID 是否发生了变化，如果 ID 没有变化则按照 `AboutPannel.vue` 中修改笔记标题的逻辑来处理，如果 ID 发生了变化，那么将根目录下的 README.md 以及 sidebar.json 文件中的记录给删除掉，在结尾插入新的笔记 ID。
- [x] 在触发更新流程时，先切换到 Loading 页面，并暂时关闭监听文件内容变化的服务，在更新完成之后，再切换到更新后的笔记页面。（注意，此时笔记的 URL 可能已经变化，如果改动了笔记所属文件夹的名称，在切出 Loading 页面的时候，需要重新更新浏览器地址栏）
  - [x] 在切换到 Loading 页面的时候，需要带上原笔记配置文件中的 id 字段，在更新完成之后，根据服务启动时的笔记列表中查询出更新结束后的正确地址完成跳转，如果笔记被删除，也就是根据 id 字段无法找到记录，那么自动跳转到 `/README` 页面。
- [x] tn:dev 在服务启动后，需要维护一个笔记列表，需要记录所有 notes 目录下的笔记 ID、笔记名称、笔记配置，在触发更新流程的时候，同时需要更新这个列表。以笔记 ID 作为列表的标识，如果该 ID 对应的笔记不在了，那么将这条记录删除，如果 ID 还在，那么更新该 ID 下的相关数据。如果在服务启动时检测到相同的笔记 ID，直接报错，提示用户存在冲突的笔记都有哪些，并终止服务。

注意：上面提到的笔记 ID 是指笔记文件夹名称前面的 4 个数字，而非笔记配置文件中的 id 字段。
